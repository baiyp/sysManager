<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.manager.task.dao.TaskDao">
	<!-- 获取企业发布任务列表信息 -->	
	<select id="queryTaskManage" parameterType="com.manager.sys.model.Task" resultType="com.manager.sys.model.Task">  
  		SELECT t.*,tc.name as taskTypeName,e.enterprise_name FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id   LIMIT #{pageNo},#{pageSize}
    </select> 
    
    <!-- 获取企业发布任务信息 -->	
	<select id="getTaskManage" parameterType="java.lang.Integer" resultType="com.manager.sys.model.Task">  
  		SELECT t.*,tc.name as taskTypeName,e.enterprise_name FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id where t.id =#{taskId}
    </select>
    
    <!--审核企业发布的任务信息-->	
	<update id="auditTaskManage">  
  		  update tendertask set  review=#{review} where id = #{taskId}
    </update>
    
    <!--更新任务表的任务状态信息 任务状态：0进行中；1 已完成；2 无人认领-->	
	<update id="updateTaskStatus">  
  		  update tendertask set  flag=1 where id = #{taskId}
    </update> 
    
    <!--更新Tender的中标状态信息 是否中标 0未中 1未通过，2通过-->	
	<update id="updateTenderWinBidding">  
  		  update tender set  qualified=2 where Id = #{taskId} and account_id=#{accountId}
    </update> 
    
    <!--更新任务认领的未中标状态信息 是否中标 0未中 1未通过，2通过-->	
	<update id="updateTenderNotWinning">  
  		  update tender set  qualified=1 where Id = #{taskId} and account_id!=#{accountId}
    </update> 
    
    <!-- 获取企业发布任务信息总数 -->	
	<select id="queryTaskManageCount"  resultType="java.lang.Integer">  
  		SELECT count(*) FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id 
    </select> 
    
    <!-- 获取企业发布任务审核通过信息，用来管理用户认领的信息 -->	
	<select id="queryTaskAssign" parameterType="com.manager.sys.model.Task" resultType="com.manager.sys.model.Task">  
  		SELECT t.*,tc.name as taskTypeName,e.enterprise_name FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id  where t.review=1  LIMIT #{pageNo},#{pageSize}
    </select> 
    
     <!-- 获取企业发布任务审核通过信息总数，用来管理用户认领的信息 -->	
	<select id="queryTaskAssignCount"  resultType="java.lang.Integer">  
  		SELECT count(*) FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id where t.review=1
    </select> 
    
    <!-- 获取每一个任务认领的公司列表 -->
	<select id="queryTaskClaimEn" parameterType="com.manager.sys.model.Task" resultType="com.manager.sys.model.Task">  
  		SELECT a.id as accountid,t.title,tc.name as taskTypeName,e.enterprise_name,tt.* FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id left join tender tt on tt.task_id=t.id where t.review=1 and t.id=#{taskId}  LIMIT #{pageNo},#{pageSize}
    </select> 
    
    <!--获取每一个任务认领的公司总数-->
	<select id="queryTaskClaimenCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">  
  		SELECT count(*) FROM tendertask t LEFT JOIN TASKCATEGORY tc on tc.id = t.category  left join account a on t.publisher = a.id  left join enterprise e on a.id= e.account_id left join tender tt on tt.task_id=t.id where t.review=1 and t.id=#{taskId}
    </select>

</mapper>